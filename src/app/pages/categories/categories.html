<div class="tournament-container">
  <h1>Cuadros de Competición</h1>

  <div *ngFor="let ageGroup of groupedLeagues$ | async | keyvalue" class="age-section">
    <h2 class="age-title">{{ ageGroup.key }}</h2>

    <div class="leagues-list">
      <div *ngFor="let league of ageGroup.value" class="league-item">
        
        <div class="league-header" 
             (click)="toggleLeague(league.id)" 
             [class.active]="expandedLeagueId === league.id">
          <span class="category-info">
            <span class="modality-tag" [class.kata]="league.categoryName.includes('KATA')">
              {{ league.categoryName.includes('KATA') ? 'K' : 'KUM' }}
            </span>
            {{ league.categoryName }}
          </span>
          <span class="chevron">{{ expandedLeagueId === league.id ? '▲' : '▼' }}</span>
        </div>

        <div class="bracket-expansion" *ngIf="expandedLeagueId === league.id">
          <div class="bracket-wrapper">
            <div *ngFor="let round of getRounds(league.matches)" class="round-column">
              <h4 class="round-header">Ronda {{ round + 1 }}</h4>
              
              <div class="matches-container">
                <div *ngFor="let match of getMatchesByRound(league.matches, round)" class="match-card">
                  
                  <div class="competitor aka" 
                       [class.winner]="match.winner === match.competitorA?.id"
                       (click)="setWinner(league.id, match.id, match.competitorA)">
                    <span class="name">{{ match.competitorA?.lastName || '---' }}</span>
                  </div>

                  <div class="vs-divider">VS</div>

                  <div class="competitor ao" 
                       [class.winner]="match.winner === match.competitorB?.id"
                       (click)="setWinner(league.id, match.id, match.competitorB)">
                    <span class="name">{{ match.competitorB?.lastName || '---' }}</span>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>