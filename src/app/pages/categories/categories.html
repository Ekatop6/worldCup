<h1>Campeonato de Karate - Cuadrante</h1>

<table class="category-table">
  <thead>
    <tr>
      <th>Selecciona una CategorÃ­a</th>
    </tr>
  </thead>
  <tbody>
    <tr
      *ngFor="let c of categories$ | async"
      (click)="selectCategory(c.id)"
      [class.selected]="selectedCategoryId === c.id"
      style="cursor:pointer"
    >
      <td>{{ c.name }}</td>
    </tr>
  </tbody>
</table>

<hr />

<div *ngIf="leagues$ | async as leagues" class="bracket-wrapper">
  <ng-container *ngIf="leagues.length > 0; else noLeague">
    
    <div class="bracket-container">
      <div *ngFor="let round of getRounds(leagues[0]?.matches ?? [])" class="round">
        <h3 class="round-title">Ronda {{ round }}</h3>
        
        <div class="matches-list">
          <div *ngFor="let match of getMatchesByRound(leagues[0]?.matches ?? [], round)" class="match-card">
            
            <div class="match-info">#{{ match.order + 1 }}</div>

            <div 
              class="competitor-row" 
              [class.winner]="match.winner?.id === match.competitorA?.id"
              [class.clickable]="match.competitorA"
              (click)="setWinner(leagues[0]?.id, match.id, match.competitorA)"
            >
              <span class="name">
                {{ match.competitorA?.firstName ?? 'Esperando...' }} 
                {{ match.competitorA?.lastName ?? '' }}
              </span>
              <span class="status-icon" *ngIf="match.winner?.id === match.competitorA?.id">ğŸ†</span>
            </div>

            <div class="separator">VS</div>

            <div 
              class="competitor-row" 
              [class.winner]="match.winner?.id === match.competitorB?.id"
              [class.clickable]="match.competitorB"
              (click)="setWinner(leagues[0]?.id, match.id, match.competitorB)"
            >
              <span class="name">
                {{ match.competitorB?.firstName ?? 'Esperando...' }} 
                {{ match.competitorB?.lastName ?? '' }}
              </span>
              <span class="status-icon" *ngIf="match.winner?.id === match.competitorB?.id">ğŸ†</span>
            </div>

          </div>
        </div>
      </div>
    </div>

  </ng-container>

  <ng-template #noLeague>
    <div class="empty-state">
      <p>No hay ninguna liga creada para esta categorÃ­a.</p>
    </div>
  </ng-template>
</div>